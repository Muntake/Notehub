<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="note">
        <h2 id="welcome"></h2>
        <button id="logoutButton" class="btn" id="logout">Logout</button>
        <div class="note-input">
            <h3 id="addNewNote">Add A New Note: </h3>
            <div class="note-wrapper">
                <input type="text" id="note-title" placeholder="note title">
                <textarea rows="5" placeholder="write note here..." id="note-content"></textarea>
                <button type="button" class="btn" id="add-note-btn">
                    <span><i class="fas fa-plus"></i></span>
                    Add Note
                </button>
            </div>
        </div>

        <div class="note-list">
            <div class="note-item">
                <!-- temp note (for visualization purposes only) -->
                <h3>Sample Note</h3>
                <p>Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Animi fugit omnis expedita porro adipisci, asperiores
                    facere ea. Voluptates quos quia consequatur explicabo.
                    Perspiciatis, repellat. Ea facere dolorum a iste maiores!</p>
                <button type="button" class="btn delete-note-btn">
                    <span><i class="fas fa-trash"></i></span>
                </button>
            </div>
        </div>

        <button type="button" class="btn" id="delete-all-btn">
            <span><i class="fas fa-trash"></i></span>
            Remove All
        </button>
    </div>

    <script>
        // get status of user on dashboard (login or register)
        var dashStatus = localStorage.getItem("dashStatus");

        // title to populate with welcome text 
        var welcome = document.getElementById("welcome");

        // if user logged in welcome them back otherwise welcome them 
        if (dashStatus == "login") {
            var loginUsername = localStorage.getItem("loginUsername");
            welcome.textContent = 'Welcome back ' + loginUsername + "!";
        } else {
            var registerUsername = localStorage.getItem("registerUsername");
            welcome.textContent = 'Welcome ' + registerUsername + "!";
        }

        // logout of dashboard (clear storage and return to login page)
        document.getElementById("logoutButton").onclick = function () {
            localStorage.clear();
            location.href = "Login.html";
        }

        const noteListDiv = document.querySelector('.note-list');

        // initialize note id as one
        let noteID = 1;

        // note object (has an ID, title and content)
        function Note(id, title, content) {
            this.id = id;
            this.title = title;
            this.content = content;
        }

        // all event listeners for the notes
        function eventListeners() {
            // for displaying notes (on page load)
            document.addEventListener('DOMContentLoaded', displayNotes);
            // for adding notes
            document.getElementById('add-note-btn').addEventListener('click', addNewNote);
            // for removing a single note
            noteListDiv.addEventListener('click', removeNote);
            // for removing all notes
            document.getElementById('delete-all-btn').addEventListener('click', removeAll);
        }

        // load event listeners
        eventListeners();

        // get notes form storage
        function getDataFromStorage() {
            return localStorage.getItem('notes') ? JSON.parse(localStorage.getItem('notes')) : [];
        }

        // add a new note in the list
        function addNewNote() {
            const noteTitle = document.getElementById('note-title'),
                noteContent = document.getElementById('note-content');
            if (validateInput(noteTitle, noteContent)) {
                let notes = getDataFromStorage();
                let noteItem = new Note(noteID, noteTitle.value, noteContent.value);
                noteID++;
                notes.push(noteItem);
                createNewNote(noteItem);
                // saving in the local storage
                localStorage.setItem('notes', JSON.stringify(notes));
                noteTitle.value = "";
                noteContent.value = "";
            }
        }

        // validate user input
        function validateInput(title, content) {
            // if title and content entered proceed 
            if (title.value !== "" && content.value !== "") {
                return true;
            } else {
                // if fields not entered warn user (timeout eventually)
                if (title.value === "") title.classList.add('warning');
                if (content.value === "") content.classList.add('warning');
            }
            setTimeout(() => {
                title.classList.remove('warning');
                content.classList.remove('warning');
            }, 1500);
        }

        // create a new note item
        function createNewNote(noteItem) {
            // create new div for note
            const div = document.createElement('div');
            // add note item and data then append to div
            div.classList.add('note-item');
            div.setAttribute('data-id', noteItem.id);
            div.innerHTML = `
        <h3>${noteItem.title}</h3>
        <p>${noteItem.content}</p>
        <button type = "button" class = "btn delete-note-btn">
        <span><i class = "fas fa-trash"></i></span>
        Remove
        </button>
    `;
            noteListDiv.appendChild(div);
        }


        // display all notes
        function displayNotes() {
            // get all notes from local storage and create divs for them on page
            let notes = getDataFromStorage();
            if (notes.length > 0) {
                noteID = notes[notes.length - 1].id;
                noteID++;
            } else {
                noteID = 1;
            }
            notes.forEach(item => {
                createNewNote(item);
            });
        }

        // deleting a note 
        function removeNote(e) {
            if (e.target.classList.contains('delete-note-btn')) {
                // remove note from storage 
                e.target.parentElement.remove();
                let divID = e.target.parentElement.dataset.id;
                let notes = getDataFromStorage();
                let newNotesList = notes.filter(item => {
                    return item.id !== parseInt(divID);
                });
                localStorage.setItem('notes', JSON.stringify(newNotesList));
            }
        }

        // removing all notes
        function removeAll() {
            // remove all notes from local storage
            localStorage.removeItem('notes');
            let noteList = document.querySelectorAll('.note-item');
            if (noteList.length > 0) {
                noteList.forEach(item => {
                    noteListDiv.removeChild(item);
                });
            }
            // after all notes deleted reset id to 1 for new notes
            noteID = 1;
        }
    </script>
</body>

</html>